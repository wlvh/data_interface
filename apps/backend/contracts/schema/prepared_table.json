{
  "$defs": {
    "PreparedTableLimits": {
      "additionalProperties": false,
      "description": "执行前的限制条件，用于保障资源消耗。",
      "properties": {
        "x-spec-version": {
          "default": "2.0.0",
          "description": "契约对象对应的 Schema 版本号，用于离线回放与迁移。",
          "title": "X-Spec-Version",
          "type": "string"
        },
        "row_limit": {
          "anyOf": [
            {
              "minimum": 1,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "单次执行允许处理的最大行数，None 表示无限制。",
          "title": "Row Limit"
        },
        "timeout_ms": {
          "anyOf": [
            {
              "minimum": 1,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "执行允许的最长耗时（毫秒）。",
          "title": "Timeout Ms"
        },
        "sample_limit": {
          "anyOf": [
            {
              "minimum": 1,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "采样用于回放的最大行数。",
          "title": "Sample Limit"
        }
      },
      "title": "PreparedTableLimits",
      "type": "object"
    },
    "PreparedTableStats": {
      "additionalProperties": false,
      "description": "变换执行前的统计信息，用于限制与审计。",
      "properties": {
        "x-spec-version": {
          "default": "2.0.0",
          "description": "契约对象对应的 Schema 版本号，用于离线回放与迁移。",
          "title": "X-Spec-Version",
          "type": "string"
        },
        "row_count": {
          "description": "输入数据的行数估计。",
          "minimum": 0,
          "title": "Row Count",
          "type": "integer"
        },
        "estimated_bytes": {
          "anyOf": [
            {
              "minimum": 0,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "输入数据的估算体积（字节）。",
          "title": "Estimated Bytes"
        },
        "distinct_row_count": {
          "anyOf": [
            {
              "minimum": 0,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "唯一行数估计，用于去重评估。",
          "title": "Distinct Row Count"
        }
      },
      "required": [
        "row_count"
      ],
      "title": "PreparedTableStats",
      "type": "object"
    },
    "TableColumn": {
      "additionalProperties": false,
      "description": "描述变换产出表的单列表结构。",
      "properties": {
        "x-spec-version": {
          "default": "2.0.0",
          "description": "契约对象对应的 Schema 版本号，用于离线回放与迁移。",
          "title": "X-Spec-Version",
          "type": "string"
        },
        "column_name": {
          "description": "列名称。",
          "minLength": 1,
          "title": "Column Name",
          "type": "string"
        },
        "data_type": {
          "description": "列的数据类型描述，例如 integer、number。",
          "minLength": 1,
          "title": "Data Type",
          "type": "string"
        },
        "semantic_role": {
          "description": "列的语义角色，用于下游建模，例如 measure、dimension。",
          "minLength": 1,
          "title": "Semantic Role",
          "type": "string"
        },
        "nullable": {
          "description": "是否允许缺失值。",
          "title": "Nullable",
          "type": "boolean"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "列的补充说明或业务含义。",
          "title": "Description"
        }
      },
      "required": [
        "column_name",
        "data_type",
        "semantic_role",
        "nullable"
      ],
      "title": "TableColumn",
      "type": "object"
    },
    "TableSample": {
      "additionalProperties": false,
      "description": "表样本，提供可回放的示例行集合。",
      "properties": {
        "x-spec-version": {
          "default": "2.0.0",
          "description": "契约对象对应的 Schema 版本号，用于离线回放与迁移。",
          "title": "X-Spec-Version",
          "type": "string"
        },
        "rows": {
          "description": "样本行集合，所有值序列化为字符串。",
          "items": {
            "additionalProperties": {
              "type": "string"
            },
            "type": "object"
          },
          "maxItems": 50,
          "title": "Rows",
          "type": "array"
        }
      },
      "title": "TableSample",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "description": "变换执行前的准备上下文，描述输入与约束。",
  "properties": {
    "x-spec-version": {
      "default": "2.0.0",
      "description": "契约对象对应的 Schema 版本号，用于离线回放与迁移。",
      "title": "X-Spec-Version",
      "type": "string"
    },
    "prepared_table_id": {
      "description": "准备阶段输出的唯一标识。",
      "minLength": 1,
      "title": "Prepared Table Id",
      "type": "string"
    },
    "source_id": {
      "description": "源数据标识，用于追踪血缘。",
      "minLength": 1,
      "title": "Source Id",
      "type": "string"
    },
    "transform_id": {
      "description": "计划中引用的变换 ID。",
      "minLength": 1,
      "title": "Transform Id",
      "type": "string"
    },
    "schema": {
      "description": "输入数据的列结构。",
      "items": {
        "$ref": "#/$defs/TableColumn"
      },
      "minItems": 1,
      "title": "Schema",
      "type": "array"
    },
    "sample": {
      "$ref": "#/$defs/TableSample",
      "description": "输入数据的摘样结果。"
    },
    "stats": {
      "$ref": "#/$defs/PreparedTableStats",
      "description": "输入数据的统计特征。"
    },
    "limits": {
      "$ref": "#/$defs/PreparedTableLimits",
      "description": "执行约束条件。"
    }
  },
  "required": [
    "prepared_table_id",
    "source_id",
    "transform_id",
    "schema",
    "sample",
    "stats",
    "limits"
  ],
  "title": "PreparedTable",
  "type": "object",
  "$id": "https://schemas.data-interface.local/contracts/prepared_table.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "version": "2.0.0"
}
