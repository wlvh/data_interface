# Data Interface

高性能数据分析与可视化系统，支持动态权重调参、交互式数据探索和实时统计分析。

## 项目概述

本项目实现了一个企业级数据接口系统，包含声明式契约系统、安全沙箱执行环境和高性能可视化组件。

### 🚀 POC演示系统

在 `poc/` 目录下包含了一个完整的概念验证系统，展示了三大核心功能：

1. **门店活跃度动态权重调参** - 6维特征实时加权评分
2. **悬浮提示与Sparkline** - 近N周趋势图与智能提示
3. **散点圈选与即时聚合** - 局部统计与敏感度分析

## 快速开始

### POC系统运行

```bash
# 克隆仓库
git clone https://github.com/wlvh/data_interface.git

# 进入POC目录
cd data_interface/poc

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

访问 http://localhost:3000 查看完整演示

## 核心特性

### 技术架构

- **声明式契约系统** - JSON定义数据模式、参数配置、图表绑定
- **Web Worker沙箱** - AST检查、隔离执行、超时控制
- **ECharts可视化** - Canvas渲染，支持万级数据点
- **参数集中管理** - 统一参数中心，Fail Fast原则
- **可回放机制** - 导出/导入实验快照，UTC时间戳

### 性能指标

- 滑块响应: <500ms
- 悬浮渲染: <16ms（单帧）
- 圈选聚合: <200ms
- 数据容量: 5万行柱状图，3万点散点图

### 安全机制

- AST黑名单（禁用window/eval/fetch等）
- 深度冻结输入数据
- 超时控制（默认5000ms）
- 输出大小限制（1MB）
- 确定性执行（固定UTC/种子随机）

## 项目结构

```
data_interface/
├── poc/                    # POC演示系统
│   ├── src/
│   │   ├── contract/       # 契约定义与校验
│   │   ├── runtime/        # 运行时组件
│   │   │   ├── params/     # 参数管理器
│   │   │   ├── worker/     # 沙箱执行器
│   │   │   └── charts/     # 图表管理器
│   │   └── ui/             # UI组件
│   ├── public/             # 静态资源
│   ├── index.html          # 主页面
│   └── README_POC.md       # POC详细文档
└── README.md               # 本文件
```

## 功能演示

### 动态权重调参
- 拖动6个特征权重滑块
- 实时重算活跃度评分
- 柱状图动态排序更新
- 贡献分解可视化

### 悬浮智能提示
- 近8/13周销售趋势
- 当周销售占比
- 节日标记显示
- 固定尺寸无抖动

### 圈选统计分析
- 矩形/套索圈选工具
- 实时计算count/mean/median/stdev
- 局部斜率分析（敏感度）
- 聚合结果卡片显示

## 数据说明

使用Walmart销售数据集（2010-2012），包含：
- 45家门店
- 143周销售数据
- 8个维度特征（销售额、温度、油价、CPI、失业率等）

## 开发指南

### 环境要求
- Node.js 16+
- npm 7+
- 现代浏览器（Chrome/Firefox/Safari最新版）

### 构建部署

```bash
# 生产构建
cd poc
npm run build

# 构建产物在 dist/ 目录
```

## 验收标准

- ✅ 滑块调整 <500ms 响应
- ✅ 悬浮提示稳定无抖动
- ✅ 圈选聚合 <200ms 完成
- ✅ Worker沙箱安全执行
- ✅ 参数集中管理
- ✅ UTC时间统一
- ✅ 错误卡片化提示
- ✅ 可导出/导入快照
- ✅ 支持5万行数据

## 后续规划

1. 引入SES/Realms强隔离
2. WebGL渲染超大数据集
3. 增量计算优化
4. WebAssembly加速
5. 单元测试覆盖

## 贡献指南

欢迎提交Issue和Pull Request。请确保：
- 遵循现有代码风格
- 添加必要的测试
- 更新相关文档

## License

MIT