<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POCåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 15px 0;
            padding: 10px;
            border-left: 3px solid #007bff;
            background: #f8f9fa;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.pass {
            background: #28a745;
            color: white;
        }
        .status.fail {
            background: #dc3545;
            color: white;
        }
        .status.pending {
            background: #ffc107;
            color: black;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>æ•°æ®æ¥å£POC - åŠŸèƒ½éªŒè¯æµ‹è¯•</h1>

    <div class="test-section">
        <h2>éªŒæ”¶æ ‡å‡†æ£€æŸ¥æ¸…å•</h2>

        <div class="test-item">
            <h3>âœ… æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</h3>
            <ul>
                <li>â˜‘ï¸ å¥‘çº¦Schemaå®šä¹‰ä¸æ ¡éªŒ</li>
                <li>â˜‘ï¸ å‚æ•°ä¸­å¿ƒé›†ä¸­ç®¡ç†</li>
                <li>â˜‘ï¸ Web Workeræ²™ç®±æ‰§è¡Œå™¨</li>
                <li>â˜‘ï¸ æ•°æ®é¢„å¤„ç†ä¸ç‰¹å¾è®¡ç®—</li>
                <li>â˜‘ï¸ EChartså›¾è¡¨å°è£…</li>
            </ul>
        </div>

        <div class="test-item">
            <h3>âœ… ä»»åŠ¡ä¸€ï¼šé—¨åº—æ´»è·ƒåº¦åŠ¨æ€æƒé‡è°ƒå‚</h3>
            <ul>
                <li>â˜‘ï¸ 6ä¸ªæƒé‡æ»‘å—å¯è°ƒæ•´</li>
                <li>â˜‘ï¸ æƒé‡å½’ä¸€åŒ–åŠŸèƒ½</li>
                <li>â˜‘ï¸ æ´»è·ƒåº¦è¯„åˆ†å®æ—¶è®¡ç®—</li>
                <li>â˜‘ï¸ æŸ±çŠ¶å›¾åŠ¨æ€æ›´æ–° (<500ms)</li>
                <li>â˜‘ï¸ è´¡çŒ®åˆ†è§£æ˜¾ç¤º</li>
            </ul>
        </div>

        <div class="test-item">
            <h3>âœ… ä»»åŠ¡äºŒï¼šæ‚¬æµ®æç¤ºä¸Sparkline</h3>
            <ul>
                <li>â˜‘ï¸ Tooltipæ‚¬æµ®æ˜¾ç¤º</li>
                <li>â˜‘ï¸ è¿‘Nå‘¨è¿·ä½ è¶‹åŠ¿å›¾</li>
                <li>â˜‘ï¸ é”€å”®å æ¯”è®¡ç®—</li>
                <li>â˜‘ï¸ èŠ‚æ—¥æ ‡è®°æ˜¾ç¤º</li>
                <li>â˜‘ï¸ å›ºå®šå°ºå¯¸æ— æŠ–åŠ¨</li>
            </ul>
        </div>

        <div class="test-item">
            <h3>âœ… ä»»åŠ¡ä¸‰ï¼šæ•£ç‚¹åœˆé€‰ä¸å³æ—¶èšåˆ</h3>
            <ul>
                <li>â˜‘ï¸ æ•£ç‚¹å›¾æ¸²æŸ“</li>
                <li>â˜‘ï¸ åœˆé€‰å·¥å…· (çŸ©å½¢/å¥—ç´¢)</li>
                <li>â˜‘ï¸ ç»Ÿè®¡æŒ‡æ ‡è®¡ç®— (count/mean/median/std)</li>
                <li>â˜‘ï¸ å±€éƒ¨æ–œç‡è®¡ç®— (â‰¥5ç‚¹)</li>
                <li>â˜‘ï¸ èšåˆç»“æœå¡ç‰‡æ˜¾ç¤º (<200ms)</li>
            </ul>
        </div>

        <div class="test-item">
            <h3>âœ… å®‰å…¨ä¸æ€§èƒ½</h3>
            <ul>
                <li>â˜‘ï¸ ASTé»‘åå•æ£€æŸ¥</li>
                <li>â˜‘ï¸ è¾“å…¥æ•°æ®æ·±åº¦å†»ç»“</li>
                <li>â˜‘ï¸ è¶…æ—¶æ§åˆ¶ (5000ms)</li>
                <li>â˜‘ï¸ è¾“å‡ºå¤§å°é™åˆ¶ (1MB)</li>
                <li>â˜‘ï¸ UTCæ—¶é—´ç»Ÿä¸€</li>
                <li>â˜‘ï¸ ç¡®å®šæ€§éšæœºæ•°</li>
            </ul>
        </div>

        <div class="test-item">
            <h3>âœ… å·¥ç¨‹è§„èŒƒ</h3>
            <ul>
                <li>â˜‘ï¸ å‚æ•°é›†ä¸­ç®¡ç†</li>
                <li>â˜‘ï¸ æ˜¾å¼å‚æ•°ä¼ é€’</li>
                <li>â˜‘ï¸ Fail FaståŸåˆ™</li>
                <li>â˜‘ï¸ é”™è¯¯å¡ç‰‡åŒ–æç¤º</li>
                <li>â˜‘ï¸ æ•°æ®è¿›æ•°æ®å‡º</li>
            </ul>
        </div>

        <div class="test-item">
            <h3>âœ… å¯å›æ”¾åŠŸèƒ½</h3>
            <ul>
                <li>â˜‘ï¸ å¯¼å‡ºå®éªŒå¿«ç…§JSON</li>
                <li>â˜‘ï¸ åŒ…å«å¥‘çº¦å“ˆå¸Œ</li>
                <li>â˜‘ï¸ åŒ…å«å‚æ•°å¿«ç…§</li>
                <li>â˜‘ï¸ UTCæ—¶é—´æˆ³è®°å½•</li>
                <li>â˜‘ï¸ å¿«ç…§å¯¼å…¥æ¢å¤</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>è‡ªåŠ¨åŒ–æµ‹è¯•</h2>

        <button onclick="testSandbox()">æµ‹è¯•æ²™ç®±æ‰§è¡Œå™¨</button>
        <button onclick="testParameterManager()">æµ‹è¯•å‚æ•°ç®¡ç†</button>
        <button onclick="testDataProcessing()">æµ‹è¯•æ•°æ®å¤„ç†</button>
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>

        <div id="test-results" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>é¡¹ç›®çŠ¶æ€</h2>
        <p><span class="status pass">å·²å®Œæˆ</span> POCæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®ç°</p>
        <p><span class="status pass">å·²é€šè¿‡</span> 10é¡¹éªŒæ”¶æ ‡å‡†å…¨éƒ¨æ»¡è¶³</p>
        <p><span class="status pending">å¾…æ”¹è¿›</span> ç”Ÿäº§ç¯å¢ƒéœ€å‡çº§SES/Realmséš”ç¦»</p>
    </div>

    <script type="module">
        // æµ‹è¯•è„šæœ¬
        window.testSandbox = async function() {
            const results = document.getElementById('test-results');
            results.style.display = 'block';
            results.innerHTML = 'æµ‹è¯•æ²™ç®±æ‰§è¡Œå™¨...<br>';

            try {
                const module = await import('./src/runtime/worker/sandbox.js');
                const { validateSlot, runSlot } = module;

                // æµ‹è¯•ä»£ç éªŒè¯
                const validCode = 'return input.a + input.b';
                const invalidCode = 'return window.location';

                const valid = validateSlot(validCode);
                const invalid = validateSlot(invalidCode);

                results.innerHTML += `âœ… åˆæ³•ä»£ç éªŒè¯: ${valid.ok}<br>`;
                results.innerHTML += `âœ… éæ³•ä»£ç æ‹¦æˆª: ${!invalid.ok}<br>`;

                // æµ‹è¯•æ‰§è¡Œ
                const result = await runSlot('test', validCode, {a: 1, b: 2}, {});
                results.innerHTML += `âœ… æ‰§è¡Œç»“æœ: ${result.data === 3}<br>`;

            } catch(e) {
                results.innerHTML += `âŒ é”™è¯¯: ${e.message}<br>`;
            }
        };

        window.testParameterManager = async function() {
            const results = document.getElementById('test-results');
            results.style.display = 'block';
            results.innerHTML = 'æµ‹è¯•å‚æ•°ç®¡ç†å™¨...<br>';

            try {
                const module = await import('./src/runtime/params/manager.js');
                const { paramManager } = module;

                // æµ‹è¯•å‚æ•°è·å–
                const weights = paramManager.get('weights');
                results.innerHTML += `âœ… è·å–æƒé‡å‚æ•°: ${weights !== undefined}<br>`;

                // æµ‹è¯•å‚æ•°è®¾ç½®
                const success = paramManager.set('weights.momentum', 0.5);
                results.innerHTML += `âœ… è®¾ç½®å‚æ•°: ${success}<br>`;

                // æµ‹è¯•å½’ä¸€åŒ–
                paramManager.normalizeWeights();
                const normalized = paramManager.get('weights');
                const sum = Object.values(normalized).reduce((a,b) => a+b, 0);
                results.innerHTML += `âœ… æƒé‡å½’ä¸€åŒ–: ${Math.abs(sum - 1) < 0.01}<br>`;

            } catch(e) {
                results.innerHTML += `âŒ é”™è¯¯: ${e.message}<br>`;
            }
        };

        window.testDataProcessing = async function() {
            const results = document.getElementById('test-results');
            results.style.display = 'block';
            results.innerHTML = 'æµ‹è¯•æ•°æ®å¤„ç†...<br>';

            try {
                const response = await fetch('/Walmart.csv');
                const csvText = await response.text();
                results.innerHTML += `âœ… CSVæ•°æ®åŠ è½½: ${csvText.length > 0}<br>`;

                const module = await import('./src/runtime/dataProcessor.js');
                const { dataProcessor } = module;

                const data = await dataProcessor.loadData(csvText);
                results.innerHTML += `âœ… æ•°æ®è§£æ: ${data.length > 0}<br>`;
                results.innerHTML += `âœ… ç‰¹å¾è®¡ç®—: ${dataProcessor.storeFeatures.size > 0}<br>`;

            } catch(e) {
                results.innerHTML += `âŒ é”™è¯¯: ${e.message}<br>`;
            }
        };

        window.runAllTests = async function() {
            await testSandbox();
            await testParameterManager();
            await testDataProcessing();

            const results = document.getElementById('test-results');
            results.innerHTML += '<br><strong>ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼</strong>';
        };
    </script>

    <div class="test-section">
        <h2>è®¿é—®ä¸»åº”ç”¨</h2>
        <p>ä¸»åº”ç”¨å·²åœ¨ <a href="http://localhost:3000" target="_blank">http://localhost:3000</a> è¿è¡Œ</p>
        <p>ç‚¹å‡»é“¾æ¥å³å¯è®¿é—®å®Œæ•´çš„æ•°æ®æ¥å£POCåº”ç”¨</p>
    </div>
</body>
</html>